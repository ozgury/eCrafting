<script type="text/javascript"> 

	if (typeof (ecr.page) == 'undefined') {
		ecr.page = {};
	};


	ecr.page.Page = function() {
		var apiWrapper = new ecr.ApiWrapper();

		return {
			doDelete: function() {
				bootbox.confirm("Are you sure you want to delete project '<%- project.name %>'?", function(confirmed) {
					if (confirmed) {
						apiWrapper.deleteCall('circles/<%- circle._id %>/calls/<%- call._id %>/projects/<%- project._id %>/', 
							function (data, jqXhr) {
								ecr.app.redirectWithSuccessMessage('/calls/show/<%- call._id %>/', "Project '<%- project.name %>' deleted.");
							}
						);
					}
				}); 
			},
		};
	};

</script> 

<div class='circle'>
	<legend><%- project.name %> in <%- call.name %> in <%- circle.name %>
		<div class="pull-right">
			<a href='/calls/show/<%- call._id %>/' class="btn"><i class="icon-eye-open"></i> <strong>Go to Call</strong></a>
			<%
			if (canEdit) {
			%>
			<!-- <a href="#" class="btn"><i class="icon-pencil"></i> <strong>Write</strong></a> -->
			<a href='/circles/<%- circle._id %>/calls/<%- call._id %>/projects/edit/<%- project._id %>/' class="btn"><i class="icon-edit"></i> <strong>Edit</strong></a>
			<a href="#" onclick='ecr.page.doDelete()' class="btn"><i class="icon-trash"></i><strong>Delete</strong></a>
			<!-- <a href="#" class="btn"><i class="icon-align-justify"></i> <strong>List</strong></a> -->
			<%
			}
			%>
		</div>
	</legend>

	<div class="row-fluid">
		<div class="span8">
			<table class="table table-striped">
		<tr>
			<th><%- t('Name') %></th>
			<td><%- project.name %></td>
		</tr>
		<tr>
			<th><%- t('Owner') %></th>
			<td><a href='/user/profile/<%- project.owner %>'><%- project.owner %></a></td>
		</tr>
		<tr>
			<th><%- t('Description') %></th>
			<td><%- project.description %></td>
		</tr>
		<tr>
			<th><%- t('Materials') %></th>
			<td><%- project._doc.materials %></td>
		</tr>
		<tr>
			<th><%- t('Location') %></th>
			<td><%- project._doc.location %></td>
		</tr>
		<tr>
			<th><%- t('Youtube Video') %></th>
			<td>
				<%
				var link = project._doc.youtube
				if(link !== undefined && link !== ""){
					if(link.indexOf("www.youtube.com") > -1){
					var youtubeLink = link.replace("/watch?v=", "/embed/");
					%>
					<iframe width="420" height="315"
							src='<%- youtubeLink %>'>
					</iframe>
					<% }
				} %>
			</td>
		</tr>
		<tr>
			<th><%- t('Media') %></th>
			<td>
			<%
			if (project.media) {
				project.media.forEach(function(m, index) {
				%>
					<ul class="thumbnails">
						<li id="media<%- index %>" class="">
							<a href="javascript:void(0)" class="thumbnail">
								<img src="/api/media/<%- m %>" alt="">
							</a>
						</li>
					</ul>
				<%
				});
			}
				%>

			</td>
		</tr>
	</table>
		</div>
	</div>
</div>
<div id="disqus_thread">
</div>
<script type="text/javascript">
	initializeDisqus({ id: 'p' + '<%- project._id %>', title: '<%- project.name %>', url: '<%- basePath %>' + '/circles/<%- circle._id %>/calls/<%- call._id %>/projects/edit/<%- project._id %>/' });
</script>
